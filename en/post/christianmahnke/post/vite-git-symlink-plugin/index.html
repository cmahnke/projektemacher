<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8"><meta property="og:url" content="https://projektemacher.org/en/post/christianmahnke/post/vite-git-symlink-plugin/">
  <meta property="og:site_name" content="Projektemacher">
  <meta property="og:title" content="Vite und Git Symlink-Dateien">
  <meta property="og:description" content="Today, Friday the 13th, I was stuck on the train in the middle of nowhere…">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2025-06-13T16:02:44+02:00">
    <meta property="article:modified_time" content="2025-06-13T16:02:44+02:00">
<title>
  Vite und Git Symlink-Dateien · Projektemacher
</title><link rel="canonical" href="https://projektemacher.org/en/post/christianmahnke/post/vite-git-symlink-plugin/"><meta name="author" content="Christian Mahnke">
<meta http-equiv="Content-Language" content="en">

<meta name="description" content="Blog factory">
<meta property="og:type" content="article" /><meta property="og:url" content="https://projektemacher.org/en/post/christianmahnke/post/vite-git-symlink-plugin/" /><meta property="og:title" content="Vite und Git Symlink-Dateien" />

  
  
    
  



<meta name="keywords" content="blog, book, digitization, history, cultural history, JavaScript, SoftwareDevelopment">
<meta name="generator" content="Hugo 0.148.2">
<meta name="projektemacher.org:build-date" content="2025-09-06 04:02:04.621759729 &#43;0000 UTC m=&#43;9.248356565"><meta name="projektemacher.org:stats" content="{&#34;count&#34;:&#34;2540&#34;,&#34;latest&#34;:&#34;2026-11-10T12:47:44&#43;02:00&#34;}">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">

<link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-16.png" sizes="16x16"><link rel="icon" type="image/svg+xml" href="https://projektemacher.org/images/cm.svg">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<link href="https://projektemacher.org/css/3dcde2e700baa65d3814003bfc8fa7f9.min.955f89e16b1a528bbcafc08bad1eca46a37f7ebbceefb7a80afb687c7d7d19e0.css" rel="stylesheet" integrity="sha256-lV&#43;J4WsaUou8r8CLrR7KRqN/frvO77eoCvtofH19GeA=">
<script src="https://projektemacher.org/js/5d85c20c8f862f9ecfa0aee0edbc8fe4.min.922583d2e8ead914d71230bc9f9e5465d65518d3ce7f50272ed030ce231e456b.js" integrity="sha256-kiWD0ujq2RTXEjC8n55UZdZVGNPOf1AnLtAwziMeRWs="></script>


    
    

    

    <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-16.png" sizes="16x16">
    
        <link rel="icon" type="image/svg+xml" href="https://projektemacher.org/images/cm.svg">
    
    <link rel="alternate" type="text/bibtex" href="https://projektemacher.org/en/post/christianmahnke/post/vite-git-symlink-plugin/citation.bib" title="Projektemacher" />
    </head>

  
  
  <body class="colorscheme-light ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://projektemacher.org/en"><img alt="Logo" class="header-logo" src="https://projektemacher.org/images/laborant.svg" />
        Projektemacher</a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/blogs/">Sites &amp; Blogs</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/posts/">News</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/archive/">Archive</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/search/">Search</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://merch.projektemacher.org/en/">Merch</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/contact/">Contact</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://projektemacher.org/post/christianmahnke/post/vite-git-symlink-plugin/">Deutsch</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


      
  <div class="content page">
    <section class="container page ">
      <article>
        <header>
          <h1 class="header">Vite und Git Symlink-Dateien</h1>
        </header>
        <p>Today, Friday the 13th, I was stuck on the train in the middle of nowhere&hellip;</p>
<p>&hellip; and since I only had a Windows laptop with me, some prototypes that I work on from time to time in such situations didn&rsquo;t work. The background is that I usually add shared files as symlinks in the same Git repository to the respective source code directories.</p>
<p>This works fine under MacOS or Linux, of course, but if you simply check out a tree under Windows, the symlinks simply become normal files that contain the link target as a relative path. Since the network is poor / slow on the train, I have made a small <a href="https://vite.dev/" target="_blank">Vite</a>/<a href="https://rollupjs.org/" target="_blank">Rollup</a> plugin that can analyse these files and load the necessary file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">path</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;node:path&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">fs</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;node:fs/promises&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * A Vite plugin that resolves file content based on the first line.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * This is a common case in repositories created on MacOS or Linux using symlinks.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * When those get checked out under Windows, these symlinks are checked out as regular
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * files, just containig the target path of the original symlink. This plugin checks each import
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * if it contains a valid path on the first line load that instead transparently.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Otherwise, it loads the content of the original file.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">gitSymlinkResolverPlugin</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">supportedExtensions</span> <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;.js&#34;</span>, <span style="color:#e6db74">&#34;.jsx&#34;</span>, <span style="color:#e6db74">&#34;.ts&#34;</span>, <span style="color:#e6db74">&#34;.tsx&#34;</span>, <span style="color:#e6db74">&#34;.css&#34;</span>, <span style="color:#e6db74">&#34;.scss&#34;</span>, <span style="color:#e6db74">&#34;.less&#34;</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;vite-plugin-git-symlink-resolver&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">enforce</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;pre&#34;</span>,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">resolveId</span>(<span style="color:#a6e22e">source</span>, <span style="color:#a6e22e">importer</span>, <span style="color:#a6e22e">options</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">importer</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;\0&#34;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">source</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#34;node_modules&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">importedFilePath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">dirname</span>(<span style="color:#a6e22e">importer</span>), <span style="color:#a6e22e">source</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">ext</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">extname</span>(<span style="color:#a6e22e">importedFilePath</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">supportedExtensions</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">ext</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#e6db74">`\0git-symlink-resolver:</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">importedFilePath</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">async</span> <span style="color:#a6e22e">load</span>(<span style="color:#a6e22e">id</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;\0git-symlink-resolver:&#34;</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalFilePath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">id</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;\0git-symlink-resolver:&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">originalFileContent</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">readFile</span>(<span style="color:#a6e22e">originalFilePath</span>, <span style="color:#e6db74">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">firstLine</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">originalFileContent</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;\n&#34;</span>)[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">?</span>.<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">firstLine</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">potentialRedirectPath</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">resolve</span>(<span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">dirname</span>(<span style="color:#a6e22e">originalFilePath</span>), <span style="color:#a6e22e">firstLine</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">stats</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">stat</span>(<span style="color:#a6e22e">potentialRedirectPath</span>);
</span></span><span style="display:flex;"><span>              <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">stats</span>.<span style="color:#a6e22e">isFile</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(
</span></span><span style="display:flex;"><span>                  <span style="color:#e6db74">`[GitSymlinkResolver] Redirecting </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">relative</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">cwd</span>(), <span style="color:#a6e22e">originalFilePath</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74"> to </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">relative</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">cwd</span>(), <span style="color:#a6e22e">potentialRedirectPath</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>
</span></span><span style="display:flex;"><span>                );
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> <span style="color:#a6e22e">fs</span>.<span style="color:#a6e22e">readFile</span>(<span style="color:#a6e22e">potentialRedirectPath</span>, <span style="color:#e6db74">&#34;utf-8&#34;</span>);
</span></span><span style="display:flex;"><span>              }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>              <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`[GitSymlinkResolver] File </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">originalFilePath</span><span style="color:#e6db74">}</span><span style="color:#e6db74"> isn&#39;t a redirect`</span>, <span style="color:#a6e22e">e</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">originalFileContent</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">error</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">error</span>(<span style="color:#e6db74">`[GitSymlinkResolver] Error reading original file </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">relative</span>(<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">cwd</span>(), <span style="color:#a6e22e">originalFilePath</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">:`</span>, <span style="color:#a6e22e">error</span>);
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This can then simply be loaded in <a href="https://vite.dev/config/" target="_blank"><code>vite.config.js</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> { <span style="color:#a6e22e">gitSymlinkResolverPlugin</span> } <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;./plugins/git-symlink-plugin.js&#34;</span>;
</span></span></code></pre></div><p>and used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">plugins</span><span style="color:#f92672">:</span> [
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">gitSymlinkResolverPlugin</span>(),
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>],
</span></span></code></pre></div>
      </article>
    </section>
</div>



    </main>
    <footer class="footer"><div class="footer-container">
    <p class="projektemacher">
        Projektemacher is a <a href="https://projektemacher.org/en/">Projektemacher</a> blog <a title="Christian Mahnke" class="footer-link-cm" href="https://christianmahnke.de/"><img src="https://projektemacher.org/images/cm.svg" style="height: 16px; margin-left: .5rem;"></a>
    </p><p class="copyright">&copy; 2009 - 2024 </p><p class="privacy"><a href="https://projektemacher.org/privacy" title="Privacy policy">Privacy policy</a></p>Powered by <div class="footer-powered-by"><a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.</div></div>

  </footer>
  </body>

</html>
