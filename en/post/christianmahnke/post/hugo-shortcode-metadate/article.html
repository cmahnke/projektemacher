<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8"><meta property="og:url" content="https://projektemacher.org/en/post/christianmahnke/post/hugo-shortcode-metadate/article.html">
  <meta property="og:site_name" content="Projektemacher">
  <meta property="og:title" content="Metadata for Hugo Shortcodes">
  <meta property="og:description" content="For my blogs I use a Hugo theme as a kind of function library…">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-01-30T18:22:44+02:00">
    <meta property="article:modified_time" content="2024-01-30T18:22:44+02:00">
<title>
  Metadata for Hugo Shortcodes · Projektemacher
</title><link rel="canonical" href="https://projektemacher.org/en/post/christianmahnke/post/hugo-shortcode-metadate/article.html"><meta name="author" content="Christian Mahnke">
  <meta name="dc.creator" content="Christian Mahnke">

<meta http-equiv="Content-Language" content="en">
<meta name="dc.type" content="Text">
<meta name="description" content="Blog factory">
<meta property="og:type" content="article" /><meta property="og:url" content="https://projektemacher.org/en/post/christianmahnke/post/hugo-shortcode-metadate/article.html" /><meta property="og:title" content="Metadata for Hugo Shortcodes" />

  
  
    
  



<meta name="keywords" content="blog, book, digitization, history, cultural history, Hugo"><meta name="dc.subject" content="blog"><meta name="dc.subject" content="book"><meta name="dc.subject" content="digitization"><meta name="dc.subject" content="history"><meta name="dc.subject" content="cultural history"><meta name="dc.subject" content="Hugo">
<meta name="generator" content="Hugo 0.156.0">
<meta name="projektemacher.org:build-date" content="2026-03-01 05:25:23.469889108 &#43;0000 UTC m=&#43;13.886235846"><meta name="projektemacher.org:stats" content="{&#34;count&#34;:&#34;5067&#34;,&#34;latest&#34;:&#34;2027-10-19T12:47:44&#43;02:00&#34;}">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no">

<link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-16.png" sizes="16x16"><link rel="icon" type="image/svg+xml" href="https://projektemacher.org/images/cm.svg">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<link href="https://projektemacher.org/css/3dcde2e700baa65d3814003bfc8fa7f9.min.da70574f9d939ceb6c2b98417c8559a15bdcab44b3c80c7fd03e43eb4da25843.css" rel="stylesheet" integrity="sha256-2nBXT52TnOtsK5hBfIVZoVvcq0SzyAx/0D5D602iWEM=">
<script src="https://projektemacher.org/js/5d85c20c8f862f9ecfa0aee0edbc8fe4.min.9e312a1385cd8a0a9b42110fe749082c05337c88e1df8799f014d3e0bddb2e9e.js" integrity="sha256-njEqE4XNigqbQhEP50kILAUzfIjh34eZ8BTT4L3bLp4="></script>


    
    

    

    <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://projektemacher.org/images/favicon-16.png" sizes="16x16">
    
        <link rel="icon" type="image/svg+xml" href="https://projektemacher.org/images/cm.svg">
    
    <link rel="alternate" type="text/bibtex" href="https://projektemacher.org/en/post/christianmahnke/post/hugo-shortcode-metadate/citation.bib" title="Projektemacher" />
    <link rel="canonical" type="text/html" href="https://projektemacher.org/en/post/christianmahnke/post/hugo-shortcode-metadate/" title="Projektemacher" />
    

    </head>

  
  
  <body class="colorscheme-light ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://projektemacher.org/en"><img alt="Logo" class="header-logo" src="https://projektemacher.org/images/laborant.svg" />
        Projektemacher</a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/blogs/">Sites &amp; Blogs</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/posts/">News</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/archive/">Archive</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/search/">Search</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://merch.projektemacher.org/en/">Merch</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="https://projektemacher.org/en/contact/">Contact</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="https://projektemacher.org/post/christianmahnke/post/hugo-shortcode-metadate/article.html">Deutsch</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


      
  <div class="content page">
    <section class="container page ">
      <article>
        <header>
          <h1 class="header">Metadata for Hugo Shortcodes</h1>
        </header>
        <p>For my blogs I use a Hugo theme as a kind of function library&hellip;</p>
<p>&hellip; which of course also includes some shortcodes. And if these require JavaScript functionality, for example, it used to be the case that this was simply integrated into a large bundle. Regardless of whether the shortcode needed it on a page, it was always delivered&hellip;</p>
<p>Not a very scalable solution, especially if the shortcode is never used. The normal way to solve this problem in Hugo is a flag that the shortcode sets and that is then evaluated when the HTML header is generated. Here is a similar example from the <a href="https://gohugo.io/content-management/diagrams/" target="_blank">documentation</a>:</p>
<p>As part of the shortcode (Instead of <a href="https://gohugo.io/methods/page/store/" target="_blank"><code>.Page.Store</code></a> you sometimes see the older <a href="https://gohugo.io/methods/page/scratch/" target="_blank"><code>.Scratch</code></a>):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go-html-template" data-lang="go-html-template"><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#a6e22e">.Page.Store.Set</span> <span style="color:#e6db74">&#34;hasMermaid&#34;</span> <span style="color:#66d9ef">true</span> <span style="color:#75715e">}}</span>
</span></span></code></pre></div><p>As part of the template that creates the HTML header:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go-html-template" data-lang="go-html-template"><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">.Store.Get</span> <span style="color:#e6db74">&#34;hasMermaid&#34;</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module&#34;</span>&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">mermaid</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mermaid</span>.<span style="color:#a6e22e">initialize</span>({ <span style="color:#a6e22e">startOnLoad</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">true</span> });
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">}}</span>
</span></span></code></pre></div><p>But especially for a function library (or in general) this is not a good / elegant solution, as the shortcodes and the header template are hard linked to each other. Therefore, new shortcodes always require adjustments to the templates. Wouldn&rsquo;t it be nicer if the information about the required scripts and stylesheets could be stored directly with the shortcode?</p>
<h2 id="extend-shortcodes">
  Extend shortcodes
  <a class="heading-link" href="#extend-shortcodes">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Since shortcodes are simply templates, you can do pretty much anything in them, e.g. define further templates, here the file <code>/layouts/shortcodes/toc.html</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go-html-template" data-lang="go-html-template"><span style="display:flex;"><span>&lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;toc&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">class</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;toc-header&#34;</span>&gt;<span style="color:#75715e">{{</span> <span style="color:#a6e22e">i18n</span> <span style="color:#e6db74">&#34;toc&#34;</span> <span style="color:#75715e">}}</span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">.Page.TableOfContents</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">div</span>&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">define</span> <span style="color:#e6db74">&#34;_partials/shortcodes/toc-metadata.html&#34;</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#e6db74">&#34;css&#34;</span> <span style="color:#66d9ef">slice</span> <span style="color:#e6db74">&#34;js&#34;</span> <span style="color:#66d9ef">slice</span> <span style="color:#e6db74">&#34;scss&#34;</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">slice</span> <span style="color:#e6db74">&#34;scss/toc.scss&#34;</span><span style="color:#f92672">))</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">jsonify</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span></code></pre></div><p>The important part here is the definition of an additional template (<code>define</code>), this follows a naming convention so that it can be found again:</p>
<ul>
<li>The template is stored in the virtual directory <code>_partials/shortcodes/</code></li>
<li>The name is that of the shortcode / template (<code>toc</code>), followed by <code>-metadata.html</code>.</li>
</ul>
<p>The shortcode defines a simple data structure in the form (as YAML):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">css</span>:
</span></span><span style="display:flex;"><span>  -
</span></span><span style="display:flex;"><span><span style="color:#f92672">js</span>:
</span></span><span style="display:flex;"><span>  -
</span></span><span style="display:flex;"><span><span style="color:#f92672">scss</span>:
</span></span><span style="display:flex;"><span>  -
</span></span></code></pre></div><p>This structure is serialised as JSON so that it can simply be passed as a string, the latter is probably optional.</p>
<h2 id="evaluate-shortcode-metadata">
  Evaluate shortcode metadata
  <a class="heading-link" href="#evaluate-shortcode-metadata">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>But the above is only half the story, somehow the data must also be available when generating the HTML header or the respective files (CSS and JavaScript).</p>
<p>Since you can only check whether a shortcode is used on a page, you first need a list of all the shortcodes used, which you can then use as a cache so that you don&rsquo;t have to look at the required pages and templates as often later on:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;"><code class="language-go-html-template" data-lang="go-html-template"><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$includes</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">dict</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodeTags</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">slice</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">$page</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">$.Site.Pages</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">with</span> <span style="color:#a6e22e">$page</span><span style="color:#a6e22e">.File</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$matches</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">findRESubmatch</span> <span style="color:#e6db74">`{{[&lt;%]\s*([^\s]*)\b.*\s*[%&gt;]}}`</span> <span style="color:#a6e22e">$page</span><span style="color:#a6e22e">.RawContent</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$matches</span> <span style="color:#f92672">=</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">partial</span> <span style="color:#e6db74">&#34;shortcodes/shortcode-helper-extract-matches.html&#34;</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#e6db74">&#34;matches&#34;</span> <span style="color:#a6e22e">$matches</span><span style="color:#f92672">)</span> <span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">$matches</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodeTags</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$shortcodeTags</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">append</span> <span style="color:#a6e22e">$matches</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{/* Remove shortcodes starting with &#39;/&#39; */}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">slice</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">$tag</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">$shortcodeTags</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">not</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">hasPrefix</span> <span style="color:#a6e22e">$tag</span> <span style="color:#e6db74">&#34;/&#34;</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">append</span> <span style="color:#a6e22e">$tag</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{/* Remove any duplicates */}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">uniq</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$candidates</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">slice</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">$shortcode</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">$shortcodes</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{/* Find definition of each found shortcode, this way we can make sure to include the ones defined by any theme */}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodeFile</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">printf</span> <span style="color:#e6db74">&#34;layouts/shortcodes/%s.html&#34;</span> <span style="color:#a6e22e">$shortcode</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">fileExists</span> <span style="color:#a6e22e">$shortcodeFile</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$shortcodeContent</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">readFile</span> <span style="color:#a6e22e">$shortcodeFile</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{/* Get the inline partial returning the required metadata for the shortcode */}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$matches</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">findRESubmatch</span> <span style="color:#e6db74">`{{-?\s*define\s*&#34;(.*-metadata.*)&#34;\s*-?}}`</span> <span style="color:#a6e22e">$shortcodeContent</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$template</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">partial</span> <span style="color:#e6db74">&#34;shortcodes/shortcode-helper-extract-matches.html&#34;</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#e6db74">&#34;matches&#34;</span> <span style="color:#a6e22e">$matches</span><span style="color:#f92672">)</span> <span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">len</span> <span style="color:#a6e22e">$template</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$template</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">index</span> <span style="color:#a6e22e">$template</span> <span style="color:#a6e22e">0</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{/* Changed for Hugo 0.146.0 */}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$template</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">replace</span> <span style="color:#a6e22e">$template</span> <span style="color:#e6db74">&#34;_partials/&#34;</span> <span style="color:#e6db74">&#34;&#34;</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$include</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">unmarshal</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">partialCached</span> <span style="color:#a6e22e">$template</span> <span style="color:#a6e22e">.</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">isset</span> <span style="color:#a6e22e">$include</span> <span style="color:#e6db74">&#34;js&#34;</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">eq</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">printf</span> <span style="color:#e6db74">&#34;%T&#34;</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">index</span> <span style="color:#a6e22e">$include</span> <span style="color:#e6db74">&#34;js&#34;</span><span style="color:#f92672">))</span> <span style="color:#e6db74">&#34;string&#34;</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$include</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">merge</span> <span style="color:#a6e22e">$include</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#e6db74">&#34;js&#34;</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">slice</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">index</span> <span style="color:#a6e22e">$include</span> <span style="color:#e6db74">&#34;js&#34;</span><span style="color:#f92672">)))</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">else</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$include</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">merge</span> <span style="color:#a6e22e">$include</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#e6db74">&#34;js&#34;</span> <span style="color:#66d9ef">slice</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{/* ... */}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$includes</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">merge</span> <span style="color:#a6e22e">$includes</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">dict</span> <span style="color:#a6e22e">$shortcode</span> <span style="color:#a6e22e">$include</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{/* Return a JSON containing all shortcodes and their required includes */}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$includes</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">jsonify</span> <span style="color:#75715e">}}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{/* Can also be a seperate file */}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">define</span> <span style="color:#e6db74">&#34;_partials/shortcodes/shortcode-helper-extract-matches.html&#34;</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$matches</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">.matches</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$rMatches</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">slice</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">$matches</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">$rMatches</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">$rMatches</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">append</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">index</span> <span style="color:#a6e22e">.</span> <span style="color:#a6e22e">1</span><span style="color:#f92672">)</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">{{-</span> <span style="color:#a6e22e">return</span> <span style="color:#a6e22e">$rMatches</span> <span style="color:#75715e">-}}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">{{-</span> <span style="color:#66d9ef">end</span> <span style="color:#75715e">-}}</span>
</span></span></code></pre></div><p>The resulting data structure now has the advantage that all possible shortcodes are known and the presence of each page can be easily checked. The template above can be stored in a variable via <code>partialCached</code>, which ensures that the complete page content only has to be run through once. The next fragment shows the use of the HTML header template:</p>
<pre tabindex="0"><code>{{- $includes := unmarshal (partialCached &#34;shortcodes/shortcode-helper-cache.html&#34; .) -}}

{{- if reflect.IsMap $includes -}}
  {{/* Loop through the shortcode cache, check if one is used in the current page and collect the necessary requirements (includes) */}}
  {{- range $shortcodeName, $refs := $includes  -}}
    {{- if $context.HasShortcode $shortcodeName -}}
      {{- if isset $refs &#34;js&#34; -}}
        {{- $js = $js | append (index $refs &#34;js&#34;) -}}
      {{- end -}}
      {{- if isset $refs &#34;css&#34; -}}
        {{- $css = $css | append (index $refs &#34;css&#34;) -}}
      {{- end -}}
      {{- if isset $refs &#34;scss&#34; -}}
        {{- $scss = $scss | append (index $refs &#34;scss&#34;) -}}
      {{- end -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
</code></pre><p>After the loop has run through, you have variables that contain the required CSS, SCSS and JavaScript files&hellip;</p>
<h2 id="potential-improvements">
  Potential improvements
  <a class="heading-link" href="#potential-improvements">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ul>
<li>Serialisation in JSON for transfer between the templates is not necessary. You could simply do without it</li>
<li>The check of whether a file really contains a metadata definition is superfluous, without it these could also be overwritten, e.g. if the shortcode is defined in a theme.</li>
</ul>
<h2 id="update-1542025">
  Update 15.4.2025
  <a class="heading-link" href="#update-1542025">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>With Hugo 0.146.0 the <a href="https://github.com/gohugoio/hugo/pull/13541" target="_blank">structure of the templates has changed</a>, therefore the path had to be changed to <code>define</code>.</p>
      </article>
    </section>
</div>



    </main>
    <footer class="footer"><div class="footer-container">
    <p class="projektemacher">
        Projektemacher is a <a href="https://projektemacher.org/en/">Projektemacher</a> blog <a title="Christian Mahnke" class="footer-link-cm" href="https://christianmahnke.de/"><img src="https://projektemacher.org/images/cm.svg" style="height: 16px; margin-left: .5rem;"></a>
    </p><p class="copyright">&copy; 2009 - 2026 </p><p class="privacy"><a href="https://projektemacher.org/privacy" title="Privacy policy">Privacy policy</a></p>Powered by <div class="footer-powered-by"><a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.</div></div>

  </footer>
  </body>

</html>
